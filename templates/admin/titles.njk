{% extends "base.njk" %}
{% set page_title = "Edit titles system" %}

{% block content %}
<nav aria-label="breadcrumb">
	<ol class="breadcrumb">
		<li class="breadcrumb-item"><a href="/admin">Admin</a></li>
		<li class="breadcrumb-item active" aria-current="page">Edit titles system</li>
	</ol>
</nav>

<p>Here you can edit the titles system. Titles are granted to each ranking within a coalition. Not to be confused with the completely separate <a href="/admin/rankings">Rankings</a>, for which only the #1 is granted a title at the end of each season.</p>

<table class="table coalition-colored">
	<thead>
		<th scope="col">Coalition</th>
		<th scope="col">Ranking</th>
		<th scope="col">Title</th>
		<th scope="col">Intra Title ID</th>
		<th scope="col">Current user(s)</th>
		<th scope="col">Intra User Title ID</th>
		<th scope="col text-end" style="text-align: end;">Options</th> <!-- for some reason the text-end class doesn't work here -->
	</thead>
	<tbody>
		{% for title in titles %}
			<tr style="background: {{ title.coalition.intra_coalition.color | rgba(0.25) }}; vertical-align: middle;">
				<td>{{ title.coalition.intra_coalition.name | striptags(true) | escape }}</td>
				<td>{{ title.ranking }}</td>
				<td>{{ title.title | striptags(true) | escape }}</td>
				<td>{{ title.intra_title_id if title.intra_title_id else "N/A" }}</td>
				{# <td>{{ title.title_users[0].user.intra_user.login if title.title_users.length > 0 else "N/A" }}</td> #}
				<td>{{ title.title_users | keyjoin('user.intra_user.login', ', ') }}</td>
				<td>{{ title.title_users | keyjoin('intra_title_user_id', ', ') }}</td>
				<td class="text-end">
					<a href="/admin/titles/{{ title.id }}/edit" class="btn btn-sm btn-outline-secondary">Edit</a>
				</td>
			</tr>
		{% endfor %}
	</tbody>
</table>

<div class="card w-100 mt-4 mb-4" id="title-new">
	<div class="card-header pe-2 d-flex align-items-center">
		<h4 class="d-inline-block pe-3 lh-lg flex-grow-1">Create a new title</h4>
		<div class="d-inline-block">

		</div>
	</div>
	<div class="card-body">
		<form action="/admin/titles/new" method="post" class="mb-3">
			<div class="mb-2">
				<label for="title" class="form-label">Title</label>
				<input type="text" id="title" name="title" class="form-control" placeholder="Title" required>
				<small class="form-text text-muted">Include <code>%login</code> in the title, as this piece of text gets replaced with the student's login.</small>
			</div>

			<div class="mb-2">
				<label for="coalition_id" class="form-label">Coalition</label>
				<select id="coalition_id" name="coalition_id" class="form-select" required>
					<option value="" disabled selected>Select a coalition...</option>
					{% for coalition in coalitions %}
						<option value="{{ coalition.id }}">{{ coalition.intra_coalition.name | striptags(true) | escape }}</option>
					{% endfor %}
				</select>
			</div>

			<div class="mb-2">
				<label for="ranking" class="form-label">Ranking</label>
				<input type="number" id="ranking" name="ranking" class="form-control" placeholder="#..." required min="1" step="1">
			</div>

			<div class="mt-4">
				<button type="submit" class="btn btn-primary w-100">Create title</button>
			</div>
		</form>
	</div>
</div>
{% endblock %}
